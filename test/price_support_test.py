import sys
sys.path.insert(0,'/Users/ernestmoney/ohmystock')

import pipe.price_support as ps


import unittest

class Test_Price_Support(unittest.TestCase):
    @classmethod
    def setUpClass(self):
        pass

    def test_get_benchmark_prices_M(self):
        data = [
        ('M','2022-12-01',23.32, 23.5,  22.99, 23.18, 83967),
        ('M','2022-12-02',23.18, 23.56, 22.99, 23.46, 69713),
        ('M','2022-12-05',23.25, 23.3,  22.56, 22.69, 62059),
        ('M','2022-12-06',22.65, 22.85, 22.01, 22.53, 84697),
        ('M','2022-12-07',22.5,  23.17, 22.37, 22.96, 84886),
        ('M','2022-12-08',23.1,  23.39, 22.82, 22.98, 66164),
        ('M','2022-12-09',22.71, 22.84, 22.02, 22.07, 75907),
        ('M','2022-12-12',22.01, 22.22, 21.64, 22.12, 70951),
        ('M','2022-12-13',22.92, 23.09, 21.41, 21.49, 12301),
        ('M','2022-12-14',21.32, 21.85, 21.2,  21.76, 93402),
        ('M','2022-12-15',21.4,  21.41, 20.88, 21.0,  59924),
        ('M','2022-12-16',20.36, 20.83, 20.21, 20.4,  103926),
        ('M','2022-12-19',20.44, 20.57, 19.93, 20.12, 107435),
        ('M','2022-12-20',20.0,  20.2,  19.86, 20.16, 68552),
        ('M','2022-12-21',20.62, 20.89, 20.22, 20.42, 69753),
        ('M','2022-12-22',20.04, 20.16, 19.4,  20.02, 72645),
        ('M','2022-12-23',19.96, 20.42, 19.71, 20.3,  59765),
        ('M','2022-12-27',20.56, 20.65, 20.15, 20.4,  74381),
        ('M','2022-12-28',20.3,  20.42, 19.73, 20.05, 80315),
        ('M','2022-12-29',20.19, 20.61, 20.17, 20.46, 87425),
        ('M','2022-12-30',20.23, 20.86, 20.12, 20.65, 82595),
        ]
        today='2022-12-29'
        # print(ps.get_benchmark_prices(self.data, today, (5,))
        # print(ps.get_benchmark_prices(self.data, today, (10,))
        self.assertEqual(ps.get_benchmark_prices(data, today, (5,)), [('2022-12-22', 20.02)])
        self.assertEqual(ps.get_benchmark_prices(data, today, (10,)), [('2022-12-15', 21.0)])

    def test_get_gap(self):
        today = '2023-02-06'
        data = [
        ('M', '2023-02-01', 23.4,  24.22, 22.1,  24.03, 13222400), 
        ('M', '2023-02-02', 24.26, 20.77, 23.97, 24.41, 6087900), 
        ('M', '2023-02-03', 24.3,  25.12, 24.27, 24.46, 9382400), 
        ('M', '2023-02-06', 24.14, 10.27, 23.72, 30.2, 4318037)
        ]
        # print(ps.get_gap(today, data))
        self.assertEqual(ps.get_gap(today, data), [('support', '2023-02-02', '31.23%'), ('support', '2023-02-06', '65.99%')])

if __name__ == '__main__':
    unittest.main()